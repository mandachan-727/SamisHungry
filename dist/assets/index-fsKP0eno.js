(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&e(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const r=class r{static getScreenDimensions(){return{width:this.SCREEN_WIDTH,height:this.SCREEN_HEIGHT}}static getGravity(){return this.GRAVITY}static getItemSpawnRate(){return this.ITEM_SPAWN_RATE}static getTargetScore(){return this.TARGET_SCORE}};r.SCREEN_WIDTH=960,r.SCREEN_HEIGHT=540,r.GRAVITY=1800,r.ITEM_SPAWN_RATE=1200,r.TARGET_SCORE=138;let a=r;class f{constructor(){this.assets={},this.assetList={background:"/assets/background.png",chest:"/assets/chest.png",mushroom:"/assets/mushroom.png",croissant:"/assets/croissant.png",lemonBar:"/assets/lemon-bar.png",pig:"/assets/pig.png",milk:"/assets/milk.png",samDefault:"/assets/sam-default.png",samRun1:"/assets/sam-run-1.png",samRun2:"/assets/sam-run-2.png",samJump:"/assets/sam-jump.png",samIll:"/assets/sam-ill.png",samYay:"/assets/sam-yay.png"}}async loadAssets(){const s=[];for(const t in this.assetList){const e=this.assetList[t];s.push(new Promise((i,n)=>{const h=new Image;h.onload=()=>{this.assets[t]=h,i()},h.onerror=o=>n(o),h.src=e}))}return await Promise.all(s),this.assets}}class p{constructor(s,t){this.gravity=s,this.assets=t,this.x=120,this.y=0,this.vx=180,this.vy=0,this.width=64,this.height=64,this.onGround=!0,this.state="default",this.runFrame=0,this.emoteTimer=0}initialize(s){this.y=s-this.height,this.onGround=!0,this.state="run1"}update(s,t){this.vy+=this.gravity*s,this.y+=this.vy*s,this.y+this.height>=t?(this.y=t-this.height,this.vy=0,this.onGround=!0,this.state==="jump"&&(this.state="run1")):this.onGround=!1,this.onGround&&(this.state==="run1"||this.state==="run2")&&(this.runFrame+=s,this.runFrame>.15&&(this.state=this.state==="run1"?"run2":"run1",this.runFrame=0)),this.emoteTimer>0&&(this.emoteTimer-=s,this.emoteTimer<=0&&this.onGround&&(this.state="run1"))}jump(){this.onGround&&(this.vy=-700,this.state="jump",this.onGround=!1)}showEmote(s){this.state=s,this.emoteTimer=.35}getBounds(){return{x:this.x,y:this.y,w:this.width,h:this.height}}render(s){let t;switch(this.state){case"run1":t=this.assets.samRun1;break;case"run2":t=this.assets.samRun2;break;case"jump":t=this.assets.samJump;break;case"ill":t=this.assets.samIll;break;case"yay":t=this.assets.samYay;break;default:t=this.assets.samDefault;break}t&&s.drawImage(t,this.x,this.y,this.width,this.height)}}class g{constructor(s,t,e){this.canvas=s,this.ctx=t,this.assets=e,this.score=0,this.items=[],this.spawnTimer=0,this.runningToChest=!1,this.chestVisible=!1,this.ended=!1,this.spawningEnabled=!0,this.visualOffsetY=-60,this.groundY=a.getScreenDimensions().height-80,this.sam=new p(a.getGravity(),e),this.sam.initialize(this.groundY)}start(){}handleJump(){!this.runningToChest&&!this.ended&&this.sam.jump()}handleClick(s){if(!this.chestVisible||this.ended)return;const t=this.canvas.getBoundingClientRect(),e=s.clientX-t.left,i=s.clientY-t.top,n=this.canvas.width-140,h=this.groundY-96;e>=n&&e<=n+96&&i>=h&&i<=h+96&&(this.ended=!0)}update(s){if(!this.ended)if(this.sam.update(s,this.groundY),!this.runningToChest)this.spawningEnabled&&(this.spawnTimer+=s*1e3,this.spawnTimer>=a.getItemSpawnRate()&&(this.spawnTimer=0,this.spawnItem())),this.updateItems(s),this.checkCollisions(),this.score>=a.getTargetScore()&&(this.score=a.getTargetScore(),this.triggerChestSequence());else{const t=this.canvas.width-140;this.sam.x<t-40&&(this.sam.x+=2)}}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const s=this.assets.background;s&&this.ctx.drawImage(s,0,0,this.canvas.width,this.canvas.height);for(const t of this.items){const e=this.getItemImage(t.type);e&&this.ctx.drawImage(e,t.x,t.y+this.visualOffsetY,t.w,t.h)}if(this.chestVisible){const t=this.assets.chest,e=this.canvas.width-140,i=96,n=96,h=this.groundY-n-40;t&&this.ctx.drawImage(t,e,h,i,n),this.ctx.fillStyle="#fff",this.ctx.font="20px sans-serif",this.ctx.fillText("Click chest!",e-10,h-10)}this.ctx.save(),this.ctx.translate(0,this.visualOffsetY),this.sam.render(this.ctx),this.ctx.restore(),this.ctx.fillStyle="#ffffff",this.ctx.font="24px sans-serif",this.ctx.fillText(`Score: ${this.score}`,16,32),this.ended&&(this.ctx.fillStyle="rgba(0,0,0,0.6)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#fff",this.ctx.font="32px sans-serif",this.ctx.fillText("Yay! Sam found the treasure!",220,240))}getItemImage(s){switch(s){case"mushroom":return this.assets.mushroom;case"croissant":return this.assets.croissant;case"lemonBar":return this.assets.lemonBar;case"pig":return this.assets.pig;case"milk":return this.assets.milk}}spawnItem(){const s=a.getTargetScore()-this.score,e=[{type:"mushroom",points:6},{type:"croissant",points:12},{type:"lemonBar",points:18},{type:"pig",points:36},{type:"milk",points:-12}].filter(m=>m.points<=s||m.points<0),i=e[Math.floor(Math.random()*e.length)],n=56,h=56,o=this.groundY-190,u=this.groundY-n-40,l=Math.random()*(u-o)+o,d={type:i.type,points:i.points,x:this.canvas.width+20,y:l,w:h,h:n,vx:-220};this.items.push(d)}updateItems(s){for(const t of this.items)t.x+=t.vx*s;this.items=this.items.filter(t=>t.x+t.w>-50)}checkCollisions(){const s=this.sam.getBounds();for(let t=this.items.length-1;t>=0;t--){const e=this.items[t];if(this.aabb(s,e)){if(e.points>0){s.y+s.h<=e.y+10&&this.sam.onGround===!1&&this.sam.vy>0&&(this.sam.y=e.y-s.h,this.sam.vy=0,this.sam.onGround=!0);const n=this.score+e.points;if(n>=a.getTargetScore()){this.score=a.getTargetScore(),this.sam.showEmote("yay"),this.items.splice(t,1),this.triggerChestSequence();continue}else this.score=n,this.sam.showEmote("yay")}else{const i=Math.max(0,this.score+e.points);this.score=i,this.sam.showEmote("ill")}this.items.splice(t,1)}}}aabb(s,t){return s.x<t.x+t.w&&s.x+s.w>t.x&&s.y<t.y+t.h&&s.y+s.h>t.y}triggerChestSequence(){this.runningToChest=!0,this.spawningEnabled=!1,this.items=[],this.chestVisible=!0}}class y{constructor(){this.config=new a,this.setupCanvas(),this.initialize()}setupCanvas(){this.canvas=document.createElement("canvas");const{width:s,height:t}=a.getScreenDimensions();this.canvas.width=s,this.canvas.height=t,document.body.appendChild(this.canvas);const e=this.canvas.getContext("2d");if(!e)throw new Error("Canvas 2D context unavailable");this.ctx=e}async initialize(){const t=await new f().loadAssets();this.currentScene=new g(this.canvas,this.ctx,t),this.bindInputs(),this.startGameLoop()}bindInputs(){window.addEventListener("keydown",s=>{(s.code==="Space"||s.code==="ArrowUp")&&this.currentScene.handleJump()}),this.canvas.addEventListener("click",s=>this.currentScene.handleClick(s))}startGameLoop(){let s=performance.now();const t=e=>{const i=(e-s)/1e3;s=e,this.currentScene.update(i),this.currentScene.render(),requestAnimationFrame(t)};requestAnimationFrame(t)}}window.onload=()=>{new y};
