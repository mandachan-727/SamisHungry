(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();const l=class l{static getScreenDimensions(){const t=Math.max(this.BASE_WIDTH,window.innerWidth||this.BASE_WIDTH),s=Math.max(this.BASE_HEIGHT,window.innerHeight||this.BASE_HEIGHT);return{width:t,height:s}}static getBaseDimensions(){return{width:this.BASE_WIDTH,height:this.BASE_HEIGHT}}static getScale(t,s){return Math.min(t/this.BASE_WIDTH,s/this.BASE_HEIGHT)}static getGravity(){return this.GRAVITY}static getItemSpawnRate(){return this.ITEM_SPAWN_RATE}static getTargetScore(){return this.TARGET_SCORE}};l.BASE_WIDTH=960,l.BASE_HEIGHT=540,l.GRAVITY=1800,l.ITEM_SPAWN_RATE=1200,l.TARGET_SCORE=138;let r=l;class y{constructor(){this.assets={},this.assetList={background:"/assets/background.png",chest:"/assets/chest.png",mushroom:"/assets/mushroom.png",croissant:"/assets/croissant.png",lemonBar:"/assets/lemon-bar.png",pig:"/assets/pig.png",milk:"/assets/milk.png",samDefault:"/assets/sam-default.png",samRun1:"/assets/sam-run-1.png",samRun2:"/assets/sam-run-2.png",samJump:"/assets/sam-jump.png",samIll:"/assets/sam-ill.png",samYay:"/assets/sam-yay.png",minhYay:"/assets/minh-yay.png",weKiss:"/assets/we-kiss.png"}}async loadAssets(){const t=[];for(const s in this.assetList){const i=this.assetList[s];t.push(new Promise((e,n)=>{const a=new Image;a.onload=()=>{this.assets[s]=a,e()},a.onerror=h=>n(h),a.src=i}))}return await Promise.all(t),this.assets}}class v{constructor(t,s){this.gravity=t,this.assets=s,this.x=120,this.y=0,this.vx=180,this.vy=0,this.width=64,this.height=64,this.onGround=!0,this.state="default",this.runFrame=0,this.emoteTimer=0,this.emoteLock=!1}initialize(t){this.y=t-this.height,this.onGround=!0,this.state="run1"}update(t,s){this.vy+=this.gravity*t,this.y+=this.vy*t,this.y+this.height>=s?(this.y=s-this.height,this.vy=0,this.onGround=!0,!this.emoteLock&&this.state!=="ill"&&(this.state==="jump"||this.state==="yay")&&(this.state="run1")):this.onGround=!1,this.onGround&&(this.state==="run1"||this.state==="run2")&&(this.runFrame+=t,this.runFrame>.15&&(this.state=this.state==="run1"?"run2":"run1",this.runFrame=0)),this.emoteTimer>0&&(this.emoteTimer-=t,this.emoteTimer<=0&&(this.emoteLock=!1,this.onGround&&this.state!=="ill"&&(this.state="run1")))}jump(){this.onGround&&(this.vy=-700,this.state="jump",this.onGround=!1)}showEmote(t){this.state=t;const s=t==="ill"?.2:.25;this.emoteTimer=Math.max(this.emoteTimer,s),this.emoteLock=!0}getBounds(){return{x:this.x,y:this.y,w:this.width,h:this.height}}render(t){let s;switch(this.state){case"run1":s=this.assets.samRun1;break;case"run2":s=this.assets.samRun2;break;case"jump":s=this.assets.samJump;break;case"ill":s=this.assets.samIll;break;case"yay":s=this.assets.samYay;break;default:s=this.assets.samDefault;break}s&&t.drawImage(s,this.x,this.y,this.width,this.height)}}class f{constructor(t,s,i){this.canvas=t,this.ctx=s,this.assets=i,this.score=0,this.items=[],this.spawnTimer=0,this.runningToChest=!1,this.chestVisible=!1,this.ended=!1,this.spawningEnabled=!0,this.visualOffsetY=-60,this.kissVisible=!1,this.amandaW=70,this.amandaH=50,this.kissW=96,this.kissH=60,this.amandaBaselineOffset=-35,this.groundY=r.getBaseDimensions().height-80,this.sam=new v(r.getGravity(),i),this.sam.initialize(this.groundY)}start(){}handleJump(){!this.runningToChest&&!this.ended&&this.sam.jump()}isEnded(){return this.ended}getAmandaRect(t=!1){const i=r.getBaseDimensions().width-140,e=this.groundY-this.amandaH-40-this.amandaBaselineOffset,n=t?e+this.visualOffsetY:e;return{x:i,y:n,w:this.amandaW,h:this.amandaH}}getKissRect(t=!1){const s=this.getAmandaRect(!1),i=s.y+s.h,e=s.x-(this.kissW-this.amandaW)/2,n=i-this.kissH,a=t?n+this.visualOffsetY:n;return{x:e,y:a,w:this.kissW,h:this.kissH}}handleClick(t){if(!this.chestVisible||this.ended)return;const s=this.canvas.getBoundingClientRect(),i=r.getBaseDimensions(),e=r.getScale(this.canvas.width,this.canvas.height),n=(this.canvas.width-i.width*e)/2,a=(this.canvas.height-i.height*e)/2,h=(t.clientX-s.left-n)/e,c=(t.clientY-s.top-a)/e,o=this.getAmandaRect(!0);h>=o.x&&h<=o.x+o.w&&c>=o.y&&c<=o.y+o.h&&(this.kissVisible=!0,this.ended=!0)}update(t){if(!this.ended)if(this.sam.update(t,this.groundY),!this.runningToChest)this.spawningEnabled&&(this.spawnTimer+=t*1e3,this.spawnTimer>=r.getItemSpawnRate()&&(this.spawnTimer=0,this.spawnItem())),this.updateItems(t),this.checkCollisions(),this.score>=r.getTargetScore()&&(this.score=r.getTargetScore(),this.triggerChestSequence());else{const s=r.getBaseDimensions().width-140;this.sam.x<s-40&&(this.sam.x+=3)}}drawOutlinedText(t,s,i,e,n,a,h="#000",c=2,o="left"){t.save(),t.font=n,t.textAlign=o,t.textBaseline="alphabetic",t.fillStyle=h,t.fillText(s,i+c,e),t.fillText(s,i-c,e),t.fillText(s,i,e+c),t.fillText(s,i,e-c),t.fillStyle=a,t.fillText(s,i,e),t.restore()}render(){const t=r.getBaseDimensions(),s=r.getScale(this.canvas.width,this.canvas.height),i=(this.canvas.width-t.width*s)/2,e=(this.canvas.height-t.height*s)/2;this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const n=this.assets.background;n&&this.ctx.drawImage(n,0,0,this.canvas.width,this.canvas.height),this.ctx.translate(i,e),this.ctx.scale(s,s);for(const a of this.items){const h=this.getItemImage(a.type);h&&this.ctx.drawImage(h,a.x,a.y+this.visualOffsetY,a.w,a.h)}if(this.chestVisible)if(this.kissVisible){const a=this.getKissRect(!1);this.ctx.save(),this.ctx.translate(0,this.visualOffsetY);const h=this.assets.weKiss;h&&this.ctx.drawImage(h,a.x,a.y,a.w,a.h),this.ctx.restore()}else{const a=this.getAmandaRect(!1);this.ctx.save(),this.ctx.translate(0,this.visualOffsetY);const h=this.assets.minhYay;h&&this.ctx.drawImage(h,a.x,a.y,a.w,a.h);const c=a.x-4,o=a.y-34;this.drawOutlinedText(this.ctx,"Click on",c,o,'14px "Bitova", sans-serif',"#ffe082"),this.drawOutlinedText(this.ctx,"Amanda!",c,o+18,'14px "Bitova", sans-serif',"#ffe082"),this.ctx.restore()}this.ctx.save(),this.ctx.translate(0,this.visualOffsetY),this.kissVisible||this.sam.render(this.ctx),this.ctx.restore(),this.kissVisible||this.drawOutlinedText(this.ctx,`Score: ${this.score}`,16,48,'24px "Bitova", sans-serif',"#ffe082"),this.ended&&(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle="rgba(0,0,0,0.6)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.kissVisible?this.drawOutlinedText(this.ctx,"Hit Space to play again!",this.canvas.width/2,this.canvas.height/2,'28px "Bitova", sans-serif',"#ffd54f","#000",2,"center"):this.drawOutlinedText(this.ctx,"Yay! Sam found the treasure!",this.canvas.width/2,this.canvas.height/2,'32px "Bitova", sans-serif',"#ffd54f","#000",2,"center"))}onResize(t,s){this.canvas.width=t,this.canvas.height=s;const i=this.sam.getBounds();this.sam.y=this.groundY-i.h,this.sam.vy=0,this.sam.onGround=!0}getItemImage(t){switch(t){case"mushroom":return this.assets.mushroom;case"croissant":return this.assets.croissant;case"lemonBar":return this.assets.lemonBar;case"pig":return this.assets.pig;case"milk":return this.assets.milk}}spawnItem(){const t=r.getTargetScore()-this.score,i=[{type:"mushroom",points:6},{type:"croissant",points:12},{type:"lemonBar",points:18},{type:"pig",points:36},{type:"milk",points:-12}].filter(m=>m.points<=t||m.points<0),e=i[Math.floor(Math.random()*i.length)],n=56,a=56,h=this.groundY-190,c=this.groundY-n-40,o=Math.random()*(c-h)+h,u={type:e.type,points:e.points,x:r.getBaseDimensions().width+20,y:o,w:a,h:n,vx:-220};this.items.push(u)}updateItems(t){for(const s of this.items)s.x+=s.vx*t;this.items=this.items.filter(s=>s.x+s.w>-50)}checkCollisions(){if(this.runningToChest||this.ended)return;const t=this.sam.getBounds(),s=r.getTargetScore();for(let i=this.items.length-1;i>=0;i--){const e=this.items[i];if(this.aabb(t,e))if(e.points>0){t.y+t.h<=e.y+10&&this.sam.onGround===!1&&this.sam.vy>0&&(this.sam.y=e.y-t.h,this.sam.vy=0,this.sam.onGround=!0);const a=Math.max(0,s-this.score),h=Math.min(a,e.points);if(this.score+=h,this.sam.showEmote("yay"),this.items.splice(i,1),this.score>=s){this.score=s,this.triggerChestSequence();break}}else this.score=Math.max(0,this.score+e.points),this.sam.showEmote("ill"),this.items.splice(i,1)}}aabb(t,s){return t.x<s.x+s.w&&t.x+t.w>s.x&&t.y<s.y+s.h&&t.y+s.h>s.y}triggerChestSequence(){this.runningToChest=!0,this.spawningEnabled=!1,this.items=[],this.chestVisible=!0}}class x{constructor(t,s,i){this.canvas=t,this.ctx=s,this.assets=i,this.ready=!1}drawOutlinedText(t,s,i,e,n,a,h="#000",c=2){t.save(),t.font=n,t.textAlign="center",t.textBaseline="middle",t.fillStyle=h,t.translate(0,0),t.shadowColor="transparent",t.fillText(s,i+c,e),t.fillText(s,i-c,e),t.fillText(s,i,e+c),t.fillText(s,i,e-c),t.fillStyle=a,t.fillText(s,i,e),t.restore()}handleClick(){this.ready=!0}handleKey(t){(t==="Space"||t==="Enter")&&(this.ready=!0)}update(t){}render(){var u,m;const t={width:r.BASE_WIDTH,height:r.BASE_HEIGHT},s=r.getScale(this.canvas.width,this.canvas.height),i=(this.canvas.width-t.width*s)/2,e=(this.canvas.height-t.height*s)/2;this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const n=(u=this.assets)==null?void 0:u.background;n?this.ctx.drawImage(n,0,0,this.canvas.width,this.canvas.height):(this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)),this.ctx.translate(i,e),this.ctx.scale(s,s);const a=(m=this.assets)==null?void 0:m.samDefault;if(a){const g=t.height-80,p=120,w=g-64;this.ctx.save(),this.ctx.translate(0,-60),this.ctx.drawImage(a,p,w,64,64),this.ctx.restore()}const h=t.width/2,c=t.height/2-120;this.drawOutlinedText(this.ctx,"Eat, Sam!",h,c,'64px "Bitova", sans-serif',"#ffd54f");const o=t.height/2-70;this.drawOutlinedText(this.ctx,"Press Space or Enter to start",h,o,'24px "Bitova", sans-serif',"#ffe082")}}class S{constructor(){this.config=new r,this.setupCanvas(),this.initialize()}setupCanvas(){this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas);const{width:t,height:s}=r.getScreenDimensions();this.canvas.width=t,this.canvas.height=s;const i=this.canvas.getContext("2d");if(!i)throw new Error("Canvas 2D context unavailable");this.ctx=i}async initialize(){const s=await new y().loadAssets();this.titleScene=new x(this.canvas,this.ctx,s),this.bindInputs(s),this.bindResize(),this.startGameLoop(()=>{if(!this.currentScene&&this.titleScene.ready){this.currentScene=new f(this.canvas,this.ctx,s);const{width:i,height:e}=r.getScreenDimensions();this.currentScene.onResize(i,e)}})}bindInputs(t){window.addEventListener("keydown",s=>{if(!this.currentScene)this.titleScene.handleKey(s.code);else{if(s.code==="Space"||s.code==="Enter"){if(this.currentScene.isEnded()){this.currentScene=new f(this.canvas,this.ctx,t);const{width:i,height:e}=r.getScreenDimensions();this.currentScene.onResize(i,e);return}this.currentScene.handleJump()}s.code==="ArrowUp"&&this.currentScene.handleJump()}}),this.canvas.addEventListener("click",s=>{this.currentScene?this.currentScene.handleClick(s):this.titleScene.handleClick()})}bindResize(){const t=()=>{const{width:s,height:i}=r.getScreenDimensions();this.currentScene&&this.currentScene.onResize(s,i)};window.addEventListener("resize",t),window.addEventListener("orientationchange",t)}startGameLoop(t){let s=performance.now();const i=e=>{const n=(e-s)/1e3;s=e,t&&t(),this.currentScene?(this.currentScene.update(n),this.currentScene.render()):(this.titleScene.update(n),this.titleScene.render()),requestAnimationFrame(i)};requestAnimationFrame(i)}}window.onload=()=>{new S};
